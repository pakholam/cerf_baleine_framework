"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createScript = exports.createScriptBll = exports.createScriptModule = exports.createView = void 0;
const fs_1 = require("fs");
const path_1 = __importDefault(require("path"));
/** 写入文件 */
function createView(directoryPath, fileName, content, isEcsComp = true) {
    return new Promise(async (resolve, reject) => {
        // 创建脚本
        let className = fileName + "View";
        let scriptUrl = "";
        if (isEcsComp) {
            scriptUrl = path_1.default.join(directoryPath, fileName) + "ViewComp.ts";
        }
        else {
            scriptUrl = path_1.default.join(directoryPath, fileName) + "View.ts";
        }
        if (!(0, fs_1.existsSync)(scriptUrl)) {
            content = content.replace(/<%Name%>/g, className);
            await Editor.Message.request('asset-db', 'create-asset', scriptUrl, content);
        }
        // 创建预制
        let prefabUrl = path_1.default.join(directoryPath, fileName) + ".prefab";
        if (!(0, fs_1.existsSync)(prefabUrl)) {
            if (isEcsComp)
                className = className + "Comp";
            await Editor.Message.request('scene', 'execute-scene-script', {
                name: "oops-framework",
                method: 'createPrefab',
                args: [fileName, className, prefabUrl]
            });
        }
        // 闪烁提示新创建的脚本文件
        Editor.Message.send('assets', 'twinkle', scriptUrl);
        // 打开脚本
        Editor.Message.request('asset-db', 'open-asset', scriptUrl);
        // 打开预制
        Editor.Message.request('asset-db', 'open-asset', prefabUrl);
        resolve();
    });
}
exports.createView = createView;
function createScriptModule(directoryPath, fileName, content) {
    return new Promise(async (resolve, reject) => {
        // 创建目录
        let pathName = fileName.toLowerCase();
        let pathModule = path_1.default.join(directoryPath, pathName);
        if (!(0, fs_1.existsSync)(pathModule)) {
            await Editor.Message.request('asset-db', 'create-asset', pathModule, null);
        }
        let subPathView = path_1.default.join(pathModule, "view");
        if (!(0, fs_1.existsSync)(subPathView)) {
            await Editor.Message.request('asset-db', 'create-asset', subPathView, null);
        }
        let subPathBll = path_1.default.join(pathModule, "bll");
        if (!(0, fs_1.existsSync)(subPathBll)) {
            await Editor.Message.request('asset-db', 'create-asset', subPathBll, null);
        }
        let subPathModel = path_1.default.join(pathModule, "model");
        if (!(0, fs_1.existsSync)(subPathModel)) {
            await Editor.Message.request('asset-db', 'create-asset', subPathModel, null);
        }
        // 创建脚本
        let scriptUrl = path_1.default.join(pathModule, fileName) + ".ts";
        if (!(0, fs_1.existsSync)(scriptUrl)) {
            content = content.replace(/<%Name%>/g, fileName);
            await Editor.Message.request('asset-db', 'create-asset', scriptUrl, content);
        }
        // 闪烁提示新创建的脚本文件
        Editor.Message.send('assets', 'twinkle', scriptUrl);
        // 打开脚本
        Editor.Message.request('asset-db', 'open-asset', scriptUrl);
        resolve();
    });
}
exports.createScriptModule = createScriptModule;
/** 创建脚本 */
function createScriptBll(directoryPath, fileName, content, moduleName) {
    return new Promise(async (resolve, reject) => {
        let scriptUrl = path_1.default.join(directoryPath, fileName) + ".ts";
        // 创建脚本
        if (!(0, fs_1.existsSync)(scriptUrl)) {
            content = content.replace(/<%Name%>/g, fileName);
            content = content.replace(/<%ModuleName%>/g, moduleName);
            await Editor.Message.request('asset-db', 'create-asset', scriptUrl, content);
        }
        // 闪烁提示新创建的脚本文件
        Editor.Message.send('assets', 'twinkle', scriptUrl);
        // 打开脚本
        Editor.Message.request('asset-db', 'open-asset', scriptUrl);
        resolve();
    });
}
exports.createScriptBll = createScriptBll;
/** 创建业务层脚本 */
function createScript(directoryPath, fileName, content, isEcsComp = true) {
    return new Promise(async (resolve, reject) => {
        let scriptUrl = "";
        if (isEcsComp) {
            scriptUrl = path_1.default.join(directoryPath, fileName) + "Comp.ts";
        }
        else {
            scriptUrl = path_1.default.join(directoryPath, fileName) + ".ts";
        }
        // 创建脚本
        if (!(0, fs_1.existsSync)(scriptUrl)) {
            content = content.replace(/<%Name%>/g, fileName);
            await Editor.Message.request('asset-db', 'create-asset', scriptUrl, content);
        }
        // 闪烁提示新创建的脚本文件
        Editor.Message.send('assets', 'twinkle', scriptUrl);
        // 打开脚本
        Editor.Message.request('asset-db', 'open-asset', scriptUrl);
        resolve();
    });
}
exports.createScript = createScript;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLXNjcmlwdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NvdXJjZS9jcmVhdGUtc2NyaXB0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDJCQUFnQztBQUNoQyxnREFBd0I7QUFFeEIsV0FBVztBQUNYLFNBQWdCLFVBQVUsQ0FBQyxhQUFxQixFQUFFLFFBQWdCLEVBQUUsT0FBZSxFQUFFLFlBQXFCLElBQUk7SUFDMUcsT0FBTyxJQUFJLE9BQU8sQ0FBTyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQy9DLE9BQU87UUFDUCxJQUFJLFNBQVMsR0FBRyxRQUFRLEdBQUcsTUFBTSxDQUFDO1FBQ2xDLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLFNBQVMsRUFBRTtZQUNYLFNBQVMsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsR0FBRyxhQUFhLENBQUM7U0FDbEU7YUFDSTtZQUNELFNBQVMsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsR0FBRyxTQUFTLENBQUM7U0FDOUQ7UUFFRCxJQUFJLENBQUMsSUFBQSxlQUFVLEVBQUMsU0FBUyxDQUFDLEVBQUU7WUFDeEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDaEY7UUFFRCxPQUFPO1FBQ1AsSUFBSSxTQUFTLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLEdBQUcsU0FBUyxDQUFDO1FBQy9ELElBQUksQ0FBQyxJQUFBLGVBQVUsRUFBQyxTQUFTLENBQUMsRUFBRTtZQUN4QixJQUFJLFNBQVM7Z0JBQUUsU0FB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MENBbUJDO0FBRUQsY0FBYztBQUNkLFNBQWdCLFlBQVksQ0FBQyxhQUFxQixFQUFFLFFBQWdCLEVBQUUsT0FBZSxFQUFFLFlBQXFCLElBQUk7SUFDNUcsT0FBTyxJQUFJLE9BQU8sQ0FBTyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQy9DLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLFNBQVMsRUFBRTtZQUNYLFNBQVMsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsR0FBRyxTQUFTLENBQUM7U0FDOUQ7YUFDSTtZQUNELFNBQVMsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUM7U0FDMUQ7UUFFRCxPQUFPO1FBQ1AsSUFBSSxDQUFDLElBQUEsZUFBVSxFQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ3hCLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNqRCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQ2hGO1FBRUQsZUFBZTtRQUNmLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFcEQsT0FBTztRQUNQLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFNUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUF4QkQsb0NBd0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gJ2ZzJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcblxyXG4vKiog5YaZ5YWl5paH5Lu2ICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVWaWV3KGRpcmVjdG9yeVBhdGg6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nLCBpc0Vjc0NvbXA6IGJvb2xlYW4gPSB0cnVlKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIC8vIOWIm+W7uuiEmuacrFxyXG4gICAgICAgIGxldCBjbGFzc05hbWUgPSBmaWxlTmFtZSArIFwiVmlld1wiO1xyXG4gICAgICAgIGxldCBzY3JpcHRVcmwgPSBcIlwiO1xyXG4gICAgICAgIGlmIChpc0Vjc0NvbXApIHtcclxuICAgICAgICAgICAgc2NyaXB0VXJsID0gcGF0aC5qb2luKGRpcmVjdG9yeVBhdGgsIGZpbGVOYW1lKSArIFwiVmlld0NvbXAudHNcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNjcmlwdFVybCA9IHBhdGguam9pbihkaXJlY3RvcnlQYXRoLCBmaWxlTmFtZSkgKyBcIlZpZXcudHNcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZXhpc3RzU3luYyhzY3JpcHRVcmwpKSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLzwlTmFtZSU+L2csIGNsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ2NyZWF0ZS1hc3NldCcsIHNjcmlwdFVybCwgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDliJvlu7rpooTliLZcclxuICAgICAgICBsZXQgcHJlZmFiVXJsID0gcGF0aC5qb2luKGRpcmVjdG9yeVBhdGgsIGZpbGVOYW1lKSArIFwiLnByZWZhYlwiO1xyXG4gICAgICAgIGlmICghZXhpc3RzU3luYyhwcmVmYWJVcmwpKSB7XHJcbiAgICAgICAgICAgIGlmIChpc0Vjc0NvbXApIGNsYXNzTmFtZSA9IGNsYXNzTmFtZSArIFwiQ29tcFwiO1xyXG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IFwib29wcy1mcmFtZXdvcmtcIixcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ2NyZWF0ZVByZWZhYicsXHJcbiAgICAgICAgICAgICAgICBhcmdzOiBbZmlsZU5hbWUsIGNsYXNzTmFtZSwgcHJlZmFiVXJsXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOmXqueDgeaPkOekuuaWsOWIm+W7uueahOiEmuacrOaWh+S7tlxyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnNlbmQoJ2Fzc2V0cycsICd0d2lua2xlJywgc2NyaXB0VXJsKTtcclxuXHJcbiAgICAgICAgLy8g5omT5byA6ISa5pysXHJcbiAgICAgICAgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAnb3Blbi1hc3NldCcsIHNjcmlwdFVybCk7XHJcblxyXG4gICAgICAgIC8vIOaJk+W8gOmihOWItlxyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ29wZW4tYXNzZXQnLCBwcmVmYWJVcmwpO1xyXG5cclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTY3JpcHRNb2R1bGUoZGlyZWN0b3J5UGF0aDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgLy8g5Yib5bu655uu5b2VXHJcbiAgICAgICAgbGV0IHBhdGhOYW1lID0gZmlsZU5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBsZXQgcGF0aE1vZHVsZSA9IHBhdGguam9pbihkaXJlY3RvcnlQYXRoLCBwYXRoTmFtZSk7XHJcbiAgICAgICAgaWYgKCFleGlzdHNTeW5jKHBhdGhNb2R1bGUpKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ2NyZWF0ZS1hc3NldCcsIHBhdGhNb2R1bGUsIG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHN1YlBhdGhWaWV3ID0gcGF0aC5qb2luKHBhdGhNb2R1bGUsIFwidmlld1wiKTtcclxuICAgICAgICBpZiAoIWV4aXN0c1N5bmMoc3ViUGF0aFZpZXcpKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ2NyZWF0ZS1hc3NldCcsIHN1YlBhdGhWaWV3LCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzdWJQYXRoQmxsID0gcGF0aC5qb2luKHBhdGhNb2R1bGUsIFwiYmxsXCIpO1xyXG4gICAgICAgIGlmICghZXhpc3RzU3luYyhzdWJQYXRoQmxsKSkge1xyXG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdjcmVhdGUtYXNzZXQnLCBzdWJQYXRoQmxsLCBudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzdWJQYXRoTW9kZWwgPSBwYXRoLmpvaW4ocGF0aE1vZHVsZSwgXCJtb2RlbFwiKTtcclxuICAgICAgICBpZiAoIWV4aXN0c1N5bmMoc3ViUGF0aE1vZGVsKSkge1xyXG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdjcmVhdGUtYXNzZXQnLCBzdWJQYXRoTW9kZWwsIG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5Yib5bu66ISa5pysXHJcbiAgICAgICAgbGV0IHNjcmlwdFVybCA9IHBhdGguam9pbihwYXRoTW9kdWxlLCBmaWxlTmFtZSkgKyBcIi50c1wiO1xyXG4gICAgICAgIGlmICghZXhpc3RzU3luYyhzY3JpcHRVcmwpKSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLzwlTmFtZSU+L2csIGZpbGVOYW1lKTtcclxuICAgICAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAnY3JlYXRlLWFzc2V0Jywgc2NyaXB0VXJsLCBjb250ZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOmXqueDgeaPkOekuuaWsOWIm+W7uueahOiEmuacrOaWh+S7tlxyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnNlbmQoJ2Fzc2V0cycsICd0d2lua2xlJywgc2NyaXB0VXJsKTtcclxuXHJcbiAgICAgICAgLy8g5omT5byA6ISa5pysXHJcbiAgICAgICAgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAnb3Blbi1hc3NldCcsIHNjcmlwdFVybCk7XHJcblxyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vKiog5Yib5bu66ISa5pysICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTY3JpcHRCbGwoZGlyZWN0b3J5UGF0aDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcsIG1vZHVsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBsZXQgc2NyaXB0VXJsID0gcGF0aC5qb2luKGRpcmVjdG9yeVBhdGgsIGZpbGVOYW1lKSArIFwiLnRzXCI7XHJcblxyXG4gICAgICAgIC8vIOWIm+W7uuiEmuacrFxyXG4gICAgICAgIGlmICghZXhpc3RzU3luYyhzY3JpcHRVcmwpKSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLzwlTmFtZSU+L2csIGZpbGVOYW1lKTtcclxuICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvPCVNb2R1bGVOYW1lJT4vZywgbW9kdWxlTmFtZSk7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ2NyZWF0ZS1hc3NldCcsIHNjcmlwdFVybCwgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDpl6rng4Hmj5DnpLrmlrDliJvlu7rnmoTohJrmnKzmlofku7ZcclxuICAgICAgICBFZGl0b3IuTWVzc2FnZS5zZW5kKCdhc3NldHMnLCAndHdpbmtsZScsIHNjcmlwdFVybCk7XHJcblxyXG4gICAgICAgIC8vIOaJk+W8gOiEmuacrFxyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ29wZW4tYXNzZXQnLCBzY3JpcHRVcmwpO1xyXG5cclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqIOWIm+W7uuS4muWKoeWxguiEmuacrCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2NyaXB0KGRpcmVjdG9yeVBhdGg6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogc3RyaW5nLCBpc0Vjc0NvbXA6IGJvb2xlYW4gPSB0cnVlKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGxldCBzY3JpcHRVcmwgPSBcIlwiO1xyXG4gICAgICAgIGlmIChpc0Vjc0NvbXApIHtcclxuICAgICAgICAgICAgc2NyaXB0VXJsID0gcGF0aC5qb2luKGRpcmVjdG9yeVBhdGgsIGZpbGVOYW1lKSArIFwiQ29tcC50c1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc2NyaXB0VXJsID0gcGF0aC5qb2luKGRpcmVjdG9yeVBhdGgsIGZpbGVOYW1lKSArIFwiLnRzXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDliJvlu7rohJrmnKxcclxuICAgICAgICBpZiAoIWV4aXN0c1N5bmMoc2NyaXB0VXJsKSkge1xyXG4gICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC88JU5hbWUlPi9nLCBmaWxlTmFtZSk7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ2NyZWF0ZS1hc3NldCcsIHNjcmlwdFVybCwgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDpl6rng4Hmj5DnpLrmlrDliJvlu7rnmoTohJrmnKzmlofku7ZcclxuICAgICAgICBFZGl0b3IuTWVzc2FnZS5zZW5kKCdhc3NldHMnLCAndHdpbmtsZScsIHNjcmlwdFVybCk7XHJcblxyXG4gICAgICAgIC8vIOaJk+W8gOiEmuacrFxyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ29wZW4tYXNzZXQnLCBzY3JpcHRVcmwpO1xyXG5cclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxufSJdfQ==